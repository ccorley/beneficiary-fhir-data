mappings:
  - id: FissClaim
    messageClassName: gov.cms.mpsm.rda.v1.fiss.FissClaim
    entityClassName: gov.cms.bfd.model.rda.PreAdjFissClaim
    transformerClassName: gov.cms.bfd.pipeline.rda.grpc.source.FissClaimTransformer2
    table:
      name: FissClaims
      schema: pre_adj
      primaryKeyColumns:
        - dcn
      columns:
        - name: dcn
          sqlType: varchar(23)
          nullable: false
        - name: sequenceNumber
          sqlType: bigint
          nullable: false
        - name: hicNo
          sqlType: varchar(12)
          nullable: false
        - name: currStatus
          sqlType: varchar(1)
          javaType: char
          nullable: false
        - name: currLoc1
          sqlType: varchar(1)
          javaType: char
          nullable: false
        - name: currLoc2
          sqlType: varchar(5)
          nullable: false
        - name: medaProvId
          sqlType: varchar(13)
        - name: medaProv_6
          sqlType: varchar(6)
        - name: totalChargeAmount
          sqlType: decimal(11,2)
        - name: receivedDate
          sqlType: date
        - name: currTranDate
          sqlType: date
        - name: admitDiagCode
          sqlType: varchar(7)
        - name: principleDiag
          sqlType: varchar(7)
        - name: npiNumber
          sqlType: varchar(10)
        - name: mbi
          sqlType: varchar(13)
        - name: mbiHash
          sqlType: varchar(64)
        - name: fedTaxNumber
          sqlType: varchar(10)
        - name: lastUpdated
          sqlType: timestamp with time zone
        - name: pracLocAddr1
          sqlType: varchar(max)
        - name: pracLocAddr2
          sqlType: varchar(max)
        - name: pracLocCity
          sqlType: varchar(max)
        - name: pracLocState
          sqlType: varchar(2)
        - name: pracLocZip
          sqlType: varchar(15)
        - name: stmtCovFromDate
          sqlType: date
        - name: stmtCovToDate
          sqlType: date
        - name: servTypeCdMapping
          enumType: ServTypeCdMapping
          sqlType: varchar(20)
        - name: lobCd
          sqlType: varchar(1)
        - name: servTypeCd
          sqlType: varchar(1)
        - name: freqCd
          sqlType: varchar(1)
        - name: billTypCd
          sqlType: varchar(3)
    enumTypes:
      - name: ServTypeCdMapping
        values:
          - Normal
          - Clinic
          - SpecialFacility
          - Unrecognized
    transformations:
      - from: dcn
        optional: false
      - from: seq
        to: sequenceNumber
        optional: false
      - from: hicNo
        optional: false
      - from: currStatus
        optional: false
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissClaimStatus
          extractorOptions: RejectUnrecognized
      - from: currLoc1
        optional: false
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissProcessingType
      - from: currLoc2
        optional: false
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissCurrentLocation2
      - from: medaProvId
      - from: medaProv6
        to: medaProv_6
      - from: totalChargeAmount
      - from: recdDtCymd
        to: receivedDate
      - from: currTranDtCymd
        to: currTranDate
      - from: admDiagCode
        to: admitDiagCode
      - from: principleDiag
      - from: npiNumber
      - from: mbi
      - from: mbi
        to: mbiHash
        transformer: IdHash
      - from: fedTaxNb
        to: fedTaxNumber
      - from: pracLocAddr1
      - from: pracLocAddr2
      - from: pracLocCity
      - from: pracLocState
      - from: pracLocZip
      - from: stmtCovFromCymd
        to: stmtCovFromDate
      - from: stmtCovToCymd
        to: stmtCovToDate
      - from: lobCd
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissBillFacilityType
      # The servTypeCdMapping is set to one of 4 enum values depending on which of the 4
      # oneof fields has a value in the FissClaim message.
      - from: servTypeCdEnum
        to: servTypeCdMapping
        transformer: EnumValueIfPresent
        transformerOptions:
          enumName: ServTypeCdMapping
          enumValue: Normal
      - from: servTypeCdForClinicsEnum
        to: servTypeCdMapping
        transformer: EnumValueIfPresent
        transformerOptions:
          enumName: ServTypeCdMapping
          enumValue: Clinic
      - from: servTypeCdForSpecialFacilitiesEnum
        to: servTypeCdMapping
        transformer: EnumValueIfPresent
        transformerOptions:
          enumName: ServTypeCdMapping
          enumValue: SpecialFacility
      - from: servTypCdUnrecognized
        to: servTypeCdMapping
        transformer: EnumValueIfPresent
        transformerOptions:
          enumName: ServTypeCdMapping
          enumValue: Unrecognized
      # The servTypeCd value is set from one of 4 possible values in a oneof within the FissClaim.
      - from: servTypeCd
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissBillClassification
          hasUnrecognized: false
      - from: servTypeCdForClinics
        to: servTypeCd
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissBillClassificationForClinics
          hasUnrecognized: false
      - from: servTypeCdForSpecialFacilities
        to: servTypeCd
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissBillClassificationForSpecialFacilities
          hasUnrecognized: false
      - from: servTypCdUnrecognized
        to: servTypeCd
      - from: freqCd
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissBillFrequency
      - from: billTypCd
      - from: NOW
        to: lastUpdated
    arrays:
      - from: fissProcCodes
        to: procCodes
        mapping: FissProcCode
      - from: fissDiagCodes
        to: diagCodes
        mapping: FissDiagnosisCode
      - from: fissPayers
        to: payers
        mapping: FissPayer

  - id: FissProcCode
    messageClassName: gov.cms.mpsm.rda.v1.fiss.FissProcedureCode
    entityClassName: gov.cms.bfd.model.rda.PreAdjFissProcCode
    table:
      name: FissProcCodes
      schema: pre_adj
      primaryKeyColumns:
        - dcn
        - priority
      columns:
        - name: dcn
          sqlType: varchar(23)
          nullable: false
        - name: priority
          sqlType: smallint
          javaType: short
          nullable: false
        - name: procCode
          sqlType: varchar(10)
          nullable: false
        - name: procFlag
          sqlType: varchar(4)
        - name: procDate
          sqlType: date
        - name: lastUpdated
          sqlType: timestamp with time zone
    transformations:
      - from: PARENT
        to: dcn
      - from: INDEX
        to: priority
      - from: procCd
        to: procCode
        optional: false
      - from: procFlag
      - from: procDt
        to: procDate
      - from: NOW
        to: lastUpdated

  - id: FissDiagnosisCode
    messageClassName: gov.cms.mpsm.rda.v1.fiss.FissDiagnosisCode
    entityClassName: gov.cms.bfd.model.rda.PreAdjFissDiagnosisCode
    table:
      name: FissDiagnosisCodes
      schema: pre_adj
      primaryKeyColumns:
        - dcn
        - priority
      columns:
        - name: dcn
          sqlType: varchar(23)
          nullable: false
        - name: priority
          sqlType: smallint
          javaType: short
          nullable: false
        - name: diagCd2
          sqlType: varchar(7)
          nullable: false
        - name: diagPoaInd
          sqlType: varchar(1)
          nullable: false
        - name: bitFlags
          sqlType: varchar(4)
        - name: lastUpdated
          sqlType: timestamp with time zone
    transformations:
      - from: PARENT
        to: dcn
      - from: INDEX
        to: priority
      - from: diagCd2
        optional: false
      - from: diagPoaInd
        optional: false
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissDiagnosisPresentOnAdmissionIndicator
      - from: bitFlags
      - from: NOW
        to: lastUpdated

  - id: FissPayer
    messageClassName: gov.cms.mpsm.rda.v1.fiss.FissPayer
    entityClassName: gov.cms.bfd.model.rda.PreAdjFissPayer
    table:
      name: FissPayers
      schema: pre_adj
      primaryKeyColumns:
        - dcn
        - priority
      columns:
        - name: dcn
          sqlType: varchar(23)
          nullable: false
        - name: priority
          sqlType: smallint
          javaType: short
          nullable: false
        - name: payerType
          enumType: PayerType
          sqlType: varchar(20)
        - name: payersId
          sqlType: varchar(1)
        - name: payersName
          sqlType: varchar(32)
        - name: relInd
          sqlType: varchar(1)
        - name: assignInd
          sqlType: varchar(1)
        - name: providerNumber
          sqlType: varchar(13)
        - name: adjDcnIcn
          sqlType: varchar(23)
        - name: priorPmt
          sqlType: decimal(11,2)
        - name: estAmtDue
          sqlType: decimal(11,2)
        - name: beneRel
          sqlType: varchar(2)
        - name: beneLastName
          sqlType: varchar(15)
        - name: beneFirstName
          sqlType: varchar(10)
        - name: beneMidInit
          sqlType: varchar(1)
        - name: beneSsnHic
          sqlType: varchar(19)
        - name: insuredRel
          sqlType: varchar(2)
        - name: insuredName
          sqlType: varchar(25)
        - name: insuredSsnHic
          sqlType: varchar(19)
        - name: insuredGroupName
          sqlType: varchar(17)
        - name: insuredGroupNbr
          sqlType: varchar(20)
        - name: beneDob
          sqlType: date
        - name: beneSex
          sqlType: varchar(1)
        - name: treatAuthCd
          sqlType: varchar(18)
        - name: insuredSex
          sqlType: varchar(1)
        - name: insuredRelX12
          sqlType: varchar(2)
        - name: insuredDob
          sqlType: date
        - name: insuredDobText
          sqlType: varchar(9)
        - name: lastUpdated
          sqlType: timestamp with time zone
    enumTypes:
      - name: PayerType
        values:
          - BeneZ
          - Insured
    transformations:
      - from: PARENT
        to: dcn
      - from: INDEX
        to: priority
      # The payerType is set to one of 2 enum values depending on which of the 2
      # nested payer fields is populated.
      - from: beneZPayer
        to: payerType
        transformer: EnumValueIfPresent
        transformerOptions:
          enumName: PayerType
          enumValue: BeneZ
      - from: insuredPayer
        to: payerType
        transformer: EnumValueIfPresent
        transformerOptions:
          enumName: PayerType
          enumValue: Insured
      - from: NONE
        to: payerType
      - from: insuredPayer.payersId
        to: payersId
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissPayersCode
      - from: insuredPayer.payersName
      - from: insuredPayer.relInd
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissReleaseOfInformation
      - from: insuredPayer.assignInd
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissAssignmentOfBenefitsIndicator
      - from: insuredPayer.providerNumber
      - from: insuredPayer.adjDcnIcn
      - from: insuredPayer.priorPmt
      - from: insuredPayer.estAmtDue
      - from: insuredPayer.insuredRel
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissPatientRelationshipCode
      - from: insuredPayer.insuredName
      - from: insuredPayer.insuredSsnHic
      - from: insuredPayer.insuredGroupName
      - from: insuredPayer.insuredGroupNbr
      - from: insuredPayer.treatAuthCd
      - from: insuredPayer.insuredSex
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissBeneficiarySex
      - from: insuredPayer.insuredRelX12
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissPatientRelationshipCode
      - from: insuredPayer.insuredDob
      - from: insuredPayer.insuredDobText
      - from: beneZPayer.payersId
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissPayersCode
      - from: beneZPayer.payersName
      - from: beneZPayer.relInd
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissAssignmentOfBenefitsIndicator
      - from: beneZPayer.assignInd
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissAssignmentOfBenefitsIndicator
      - from: beneZPayer.providerNumber
      - from: beneZPayer.adjDcnIcn
      - from: beneZPayer.priorPmt
      - from: beneZPayer.estAmtDue
      - from: beneZPayer.beneRel
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissPatientRelationshipCode
      - from: beneZPayer.beneLastName
      - from: beneZPayer.beneFirstName
      - from: beneZPayer.beneMidInit
      - from: beneZPayer.beneSsnHic
      - from: beneZPayer.insuredGroupName
      - from: beneZPayer.beneDob
      - from: beneZPayer.beneSex
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissBeneficiarySex
      - from: beneZPayer.treatAuthCd
      - from: beneZPayer.insuredSex
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissBeneficiarySex
      - from: beneZPayer.insuredRelX12
        transformer: MessageEnum
        transformerOptions:
          enumClass: gov.cms.mpsm.rda.v1.fiss.FissPatientRelationshipCode
      - from: NOW
        to: lastUpdated
